<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Umfrage wird geladen</title>
    <script src="/js/vendor/htmx.min.js"></script>
    <link rel="stylesheet" href="/css/app.css">
</head>
<body>
<div class="page-shell" id="poll-content" th:attr="data-fragment-path=${fragmentPath}">
    <header>
        <h1>Woodle</h1>
    </header>

    <main class="panel-grid">
        <section class="content-card loading-card">
            <div class="loading-spinner" aria-hidden="true"></div>
            <p id="loading-message">Bitte noch ein bischen Geduld, wir laden gerade die Umfrage</p>
            <p id="loading-error" class="form-error" hidden>Die Umfrage wurde nicht gefunden oder ist derzeit nicht erreichbar.</p>
            <div id="poll-ready-probe"
                 th:attr="hx-get=${readyPath},data-fragment-path=${fragmentPath}"
                 hx-trigger="load, every 1.5s"
                 hx-target="this"
                 hx-swap="innerHTML"
                 hidden></div>
        </section>
    </main>
</div>
<script src="/js/woodle-ui.js"></script>
<script>
    (function () {
        const probe = document.getElementById('poll-ready-probe');
        if (!probe) {
            if (window.WoodleUi) {
                window.WoodleUi.refreshAdminTimeControls();
            }
            return;
        }

        probe.addEventListener('htmx:afterSwap', function () {
            if (probe.textContent.trim() !== 'ready') {
                return;
            }
            probe.removeAttribute('hx-trigger');
            const target = document.getElementById('poll-content');
            if (!target) {
                return;
            }
            htmx.ajax('GET', probe.dataset.fragmentPath, {target: target, swap: 'outerHTML'});
        });

        probe.addEventListener('htmx:responseError', function (event) {
            if (event.detail.xhr.status !== 404) {
                return;
            }
            probe.removeAttribute('hx-trigger');
            const error = document.getElementById('loading-error');
            if (error) {
                error.hidden = false;
            }
        });
        if (window.WoodleUi) {
            window.WoodleUi.refreshAdminTimeControls();
        }
    })();
</script>
</body>
</html>
